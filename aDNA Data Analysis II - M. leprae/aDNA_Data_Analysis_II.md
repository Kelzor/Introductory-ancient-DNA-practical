# aDNA Data Analysis II: assessment and evolutionary analysis of ancient Mycobacterium leprae genomes

## Scenario

You have received NGS *Mycobacterium leprae* capture data for three skeletons from Sant Llàtzer, a medieval leprosarium in Barcelona: **UF104**, **UF703**, **UF801**. 

The genetic diversity of *M. leprae* strains across medieval Europe and within leprosaria was high. No one has recovered ancient *M. leprae* genomes from Spain, so you would like to know if leprosy infections at Sant Llátzer were seeded by a diversity of lineages.  

## Part 1: Using Qualimap to determin reference coverage and depth

Since you have already assessed these raw data (*aDNA Data Analysis I*), you will begin this practical by using **Qualimap** to assess genome coverage and depth from `.bam` files that were generated by mapping reads to the *Mycobacterium leprae* reference genome. 

I have run the tool for you, and you have the outputs: a `.pdf` report and a `.txt` file for each sample.

Open [Sant_Llàtzer_M.leprae_mapping_report](https://github.com/Kelzor/Introductory-ancient-DNA-practical/blob/main/aDNA%20Data%20Analysis%20II%20-%20M.%20leprae/M.leprae%20mapping%20report.tsv) in a new tab (right click). Since you cannot edit this file directly, download it using the download icon in the top right corner. The extension is `.tsv`, which stands for "tab-separated values." Open this file using excel to be able to edit the spreadsheet.

[**Qualimap**](http://qualimap.conesalab.org/) is a tool that assesses genome coverage and depth from `.bam` files. I have run the tool for you and generated outputs.

|  Qualimap `.pdf` report | Qualimap `.txt` report |
|-------------|-------------|
| [UF104.pdf](https://github.com/Kelzor/Introductory-ancient-DNA-practical/blob/main/aDNA%20Data%20Analysis%20II%20-%20M.%20leprae/1.Qualimap%20outputs/UF104_report.pdf) | [UF104.txt](https://github.com/Kelzor/Introductory-ancient-DNA-practical/blob/main/aDNA%20Data%20Analysis%20II%20-%20M.%20leprae/1.Qualimap%20outputs/UF104_genome_results.txt) |
|  [UF703.pdf](https://github.com/Kelzor/Introductory-ancient-DNA-practical/blob/main/aDNA%20Data%20Analysis%20II%20-%20M.%20leprae/1.Qualimap%20outputs/UF703_report.pdf)  | [UF703.txt](https://github.com/Kelzor/Introductory-ancient-DNA-practical/blob/main/aDNA%20Data%20Analysis%20II%20-%20M.%20leprae/1.Qualimap%20outputs/UF703_genome_results.txt) |
| [UF801.pdf](https://github.com/Kelzor/Introductory-ancient-DNA-practical/blob/main/aDNA%20Data%20Analysis%20II%20-%20M.%20leprae/1.Qualimap%20outputs/UF801_report.pdf)  | [UF801.txt](https://github.com/Kelzor/Introductory-ancient-DNA-practical/blob/main/aDNA%20Data%20Analysis%20II%20-%20M.%20leprae/1.Qualimap%20outputs/UF801_genome_results.txt) |

Open the `.pdf` reports for your samples.

Fill in the following columns in the mapping report:

- `Q25 mapped reads after duplicate removal` 
- `Avg length of mapped Q25 reads`
- `Mean Cov`
- `SD Cov`  

Now that you have read through the `.pdf` reports, open the **Qualimap** `.txt` files. Much — but not all — of the information from the `.pdf` is reported here as well. 

Text file outputs are useful because you can write code that will loop through `.txt` files and pull out the information you need. Most geneticists automate their mapping reports so that they do not have to manually extract each piece of information.  

Complete the next two columns in your **Sant Llátzer mapping report** using the **Qualimap** `.txt` files.:

- `% ref covered at >=1x`  
- `% ref covered at >=5x`  

Some of the metrics you need to assess your data are not generated by a tool, so you need to generate them yourself. **Cluster factor**, also known as **library complexity**, is informative about the number of unique fragments in your library. It tells you on average how many times a read was sequenced. **Library complexity** refers to how many unique DNA fragments are in your sequencing data. One way to measure this is by looking at the number or percentage of **duplicate reads**, which are reads that start and end at the same positions when aligned to a reference genome. They occur during the multiple rounds of PCR necessary to prepare a library for sequencing.

For example:
- **Cluster values over 2** indicate that, on average, every fragment has been sequenced twice — meaning the library is likely exhausted of DNA from this organism.
- Depending on how deeply you sequence and whether you’ve done targeted enrichment, **cluster factors can be huge**, ranging anywhere between **20 and 30**.

In your mapping report, **Calculate cluster factor** for each sample using the formula in the column header and the values in the columns you’ve already filled out.

**Endogenous DNA Frequency**

Endogenous DNA frequency can be used alongside cluster factor to decide whether to sequence your library more deeply or to assess how efficient your capture enrichment was. Since these *M. leprae* data were obtained through targeted capture enrichment, endogenous DNA frequency will show how effective the capture experiment was.

**Calculate the frequency of endogenous DNA** (*M. leprae* in this case) for each sample using the formula in the column header cell and the values in the columns you’ve already filled out.


